#　アップデート時は必ずデータのバックアップを取ってください！
#　その他タブにあるプロンプト辞書ダウンロードと要素辞書(ローカル)ダウンロードをしておいてください。このデータが有れば引き継ぎはできます。

# Prompt Generator

画像生成 AI（Stable Diffusion、NovelAI、ComfyUI 等）用のプロンプトを効率的に管理・生成する Chrome 拡張機能です。
## 📌 プライバシーについて

PromptGeneratorは、ユーザーのプライバシーを尊重し、必要最小限の情報のみを収集します。検索機能で入力されたキーワードは、今後の辞書更新の参考とするため、検索ワードと追加要素を収集する場合があります。

### 📊 収集する情報
- 検索ワード
- 追加要素

**利用目的**: 辞書機能の改善とマスターデータの拡充のためにのみ使用されます。

### 🔒 収集しない情報
- 個人情報（名前、メールアドレス等）
- 生成したプロンプト
- 保存されたスロットデータ
- 辞書に登録した個人データ
- その他のユーザーデータ

**プライベートなデータは一切収集されません。すべてローカルに保存されます。**

### 📍 重要事項
収集されるデータは辞書機能の改善のためにのみ使用され、第三者に提供されることはありません。すべてのプライベートなデータはお使いのブラウザのローカルストレージに安全に保存されます。

**技術的な詳細**: 検索ログの収集は api-client.js の SearchLogAPI で行われ、検索ワード以外の情報は一切取得していません。

## 🌟 主な機能

### 1. プロンプト管理

- **複数プロンプトスロット**: プロンプトを切り替えて管理
- **スロット管理**: 専用タブで一覧表示・編集、Ctrl+1〜9 でクイック切り替え
- **全スロット結合**: Generate ボタンで全スロットを結合して生成
- プロンプトの保存・読み込み
- カテゴリー別の整理（大・中・小カテゴリー）

### 2. 高度な要素抽出機能 ✨

- **通常モード**: 従来のテキスト編集
- **ランダム抽出モード**: カテゴリーから毎回ランダムに 1 要素を選択
- **連続抽出モード**: カテゴリーから順番に 1 要素を選択
- カテゴリーフィルターで抽出範囲を指定
- Generate 時のリアルタイム抽出表示（タイムスタンプ付き）

### 3. 検索・翻訳機能

- キーワード検索とカテゴリーフィルター
- Google 翻訳/DeepL API による自動翻訳
- 検索結果からワンクリックで追加

### 4. 編集機能

- ドラッグ&ドロップで要素の並び替え
- 重み付け編集（SD/NAI/None 形式対応）
- テキスト編集モード/選択編集モード
- サイトに応じた記法の自動切り替え

### 5. 辞書機能

- ユーザー辞書（カスタム辞書）
- マスター辞書（デフォルト辞書）
- お気に入りリスト（よく使うプロンプトの保存）
- CSV 形式でのインポート/エクスポート

### 6. ビジュアルセレクター機能 🎯

- マウスホバーで要素をハイライト表示
- クリックで自動的に CSS セレクターを取得
- セレクター候補の自動生成とスコアリング
- リアルタイムでセレクターの有効性を検証

### 7. マルチサービス対応 🌐

- **対応サービス**: NovelAI、Stable Diffusion WebUI、ComfyUI 等
- サービスごとのプリセット選択
- URL に応じて自動的にサービスを判定
- 任意の AI 画像生成サービスで使用可能

### 8. 自動化機能

- **自動 Generate**: 指定回数・間隔での連続生成
- **自動保存**: 拡張機能終了時の状態保存
- **連続カンマの自動正規化**: 入力ミスを自動修正

### 9. データ管理

- PNG 画像からのプロンプト情報抽出
- 設定の完全バックアップ/リストア（JSON 形式）
- CSV ファイルのドラッグ&ドロップ対応

### 10. その他の便利機能

- **ショートカットキー**: Alt+G（サイドパネル）、Ctrl+S（保存）、Ctrl+K（検索）等
- **コンテキストメニュー**: 右クリックから素早くアクセス
- **セレクター管理**: 「その他」タブで詳細設定

## 📦 インストール方法

### 初回インストール

1. **リポジトリをダウンロード**

   ```bash
   git clone https://github.com/MilkyPuree/PromptGenerator.git
   ```

   または [Releases](https://github.com/MilkyPuree/PromptGenerator/releases) から最新版の ZIP ファイルをダウンロード

2. **Chrome の拡張機能ページを開く**

   - Chrome のアドレスバーに `chrome://extensions/` を入力
   - または、メニュー → その他のツール → 拡張機能

3. **デベロッパーモードを有効化**

   - 右上の「デベロッパーモード」を ON にする

4. **拡張機能を読み込む**

   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - ダウンロードしたフォルダを選択

5. **インストール完了**
   - ツールバーに拡張機能のアイコンが表示されます
   - ピン留めしておくと便利です

## 🔄 更新方法

### 方法 1: Git を使用（推奨）

```bash
# プロジェクトフォルダに移動
cd PromptGenerator

# 最新版を取得
git pull origin main

# Chrome拡張機能ページで「更新」ボタンをクリック
```

### 方法 2: 手動更新

1. [Releases](https://github.com/MilkyPuree/PromptGenerator/releases) から最新版をダウンロード
2. 既存のフォルダに上書き（設定は `chrome.storage` に保存されているので消えません）
3. Chrome 拡張機能ページで「更新」ボタンをクリック

## 🚀 使い方

### 📖 詳細な使い方ガイド

各機能の詳細な使い方を、実践的な例と共に分かりやすく解説したインタラクティブチュートリアルをご用意しています。

#### 🎮 チュートリアルガイド

- **🔍 検索タブ** - キーワード・カテゴリ検索のマスター
- **✏️ 編集タブ** - プロンプト編集・並び替え・翻訳の活用
- **💾 スロットタブ** - プロンプト保存・グループ管理の応用
- **📚 辞書タブ** - オリジナル辞書作成・CSV活用の技術
- **🎯 ヘッダー機能** - Generate・履歴・設定・ショートカット

**→ [詳細な使い方ガイドを見る](配布ページ/tutorial/index.html)** - 実際の拡張機能と同じUIで体験学習！

### 基本的な使い方

1. **拡張機能アイコンをクリック**してポップアップを開く（または Alt+G でサイドパネル）

2. **検索タブ**

   - キーワードを入力して検索
   - カテゴリーで絞り込み
   - 「Set」で現在のプロンプトに追加、「Copy」でクリップボードにコピー

3. **辞書タブ**

   - プロンプトを「Save」ボタンで保存
   - 要素を追加して独自の辞書を作成
   - CSV エクスポート/インポート対応

4. **編集タブ**

   - 現在のプロンプトの要素を個別に編集
   - 重み付けを調整（SD/NAI/None 形式）
   - ドラッグ&ドロップで順序変更

5. **スロットタブ**

   - 10 個のプロンプトスロットを管理
   - 各スロットに名前を付けて整理
   - 要素抽出モードの設定（通常/ランダム/連続）

6. **その他タブ**
   - セレクター設定（ビジュアルセレクター）
   - DeepL API キー設定
   - 設定のバックアップ/リストア

### ショートカットキー

**ポップアップ内**

- **Ctrl+S**: 現在のプロンプトを辞書に保存
- **Ctrl+C**: プロンプトをコピー
- **Ctrl+K**: 検索ボックスにフォーカス
- **Ctrl+1〜9**: プロンプトスロット切り替え
- **Tab**: タブ間の移動

**グローバル**

- **Alt+G**: サイドパネルを開く
- **Ctrl+Shift+S**: 選択テキストを辞書に保存

### 高度な使い方

#### 要素抽出モード

1. スロットタブで任意のスロットを選択
2. モードを「ランダム」または「連続」に設定
3. カテゴリーフィルターで抽出範囲を指定
4. Generate 時に自動的に要素が選択されます

#### ビジュアルセレクター

1. 「その他」タブを開く
2. サービスプリセットを選択（または手動設定）
3. 「👁」ボタンをクリックして選択モード開始
4. ページ上の要素をクリックしてセレクターを取得
5. 「保存」ボタンで設定を保存

#### 自動 Generate

1. 「その他」タブで「自動 Generate」にチェック
2. 生成回数と間隔を設定（0 = 無限）
3. Generate ボタンを押すと自動実行開始

### 🤖 高度な機能説明

#### ⚡ 自動ジェネレート機能

PromptGeneratorには、繰り返し作業を効率化する自動ジェネレート機能が搭載されています。

**主な機能:**
- **バッチ生成**: 複数のプロンプトパターンを一度に生成
- **テンプレート適用**: 事前に作成したテンプレートを自動適用
- **ランダム要素**: 指定したカテゴリからランダムに要素を選択
- **条件分岐**: IF文のような条件に応じた要素の切り替え

**使用例:**
```
テンプレート: "{{character}}, {{pose}}, {{background}}"
↓ 自動生成
1. "beautiful anime girl, standing pose, school classroom"
2. "cute anime girl, sitting pose, outdoor park"
3. "cool anime girl, running pose, city street"
```

#### 🎯 ビジュアルセレクタ更新機能

NovelAIなどのWebサービスでHTML要素が更新された場合でも、ビジュアルセレクタにより自動で対応できます。

**対応方法:**
- **要素検出**: ページ上のプロンプト入力欄を自動検出
- **セレクタ更新**: HTMLが変更されても新しいセレクタに自動適応
- **フォールバック**: 複数の検出パターンで確実にターゲット発見
- **手動調整**: 必要に応じてユーザーが手動でセレクタを指定可能

**サポート対象:**
- ✅ NovelAI (プロンプト入力欄)
- ✅ Stable Diffusion WebUI (txt2img/img2img)
- ✅ ChatGPT (カスタムGPTs)
- ✅ その他のAI画像生成サービス

## 📁 フォルダ構成

```
PromptGenerator/
├── manifest.json          # 拡張機能の設定
├── popup.html             # メインUI（すべてのスクリプトの読み込み順序を定義）
├── README.md              # このファイル
├── CLAUDE.md              # 開発ガイドライン・技術仕様書
│
├── css/                   # スタイルシート（テーマ対応・モジュール化済み）
│   ├── variables.css          # CSS変数・テーマ定義
│   ├── base.css              # 基本スタイル
│   ├── header.css            # ヘッダー部分
│   ├── components.css        # 汎用コンポーネント
│   ├── utilities.css         # ユーティリティクラス
│   ├── components/           # 専用コンポーネント
│   │   ├── flexible-list.css     # フレキシブルリスト専用
│   │   └── dictionary-modal.css  # 辞書管理モーダル
│   └── tabs/                 # タブ別スタイル
│       ├── search.css            # 検索タブ
│       ├── dictionary.css        # 辞書タブ
│       ├── edit.css             # 編集タブ
│       └── slot.css             # スロットタブ
│
├── js/                    # JavaScript（モジュラー設計・Phase 8.5完了）
│   ├── background.js          # バックグラウンド処理（コンテキストメニュー管理）
│   ├── main.js               # メインアプリケーション（全体統括・1000行超）
│   ├── content.js            # コンテンツスクリプト（ビジュアルセレクター）
│   │
│   ├── core/                 # コア機能（システム基盤）
│   │   ├── storage.js            # Chrome Storage APIラッパー
│   │   ├── app-state.js          # グローバル状態管理（全モジュール参照）
│   │   ├── error-handler.js      # エラー処理・通知システム
│   │   ├── validators.js         # 入力検証・バリデーション
│   │   └── constants/            # 定数管理（専用サブフォルダ）
│   │       ├── app-constants.js      # 数値定数（マジックナンバー管理）
│   │       ├── messages.js           # メッセージ・FlexibleList定数
│   │       ├── dom-constants.js      # DOM要素定数（ID・セレクター管理）
│   │       └── storage-keys.js       # ストレージ・辞書関連定数
│   │
│   ├── data/                 # データ管理
│   │   ├── data-manager.js       # データ永続化（storage.js使用）
│   │   ├── category-manager.js   # カテゴリー管理（app-state連携）
│   │   ├── prompt-editor.js      # プロンプト編集エンジン（main.js参照）
│   │   └── prompt-slots.js       # 複数スロット管理（app-state同期）
│   │
│   ├── ui/                   # UI関連（タブシステム・FlexibleList）
│   │   ├── components/           # 再利用可能UI部品
│   │   │   ├── ui-factory.js         # UI要素生成（各タブ使用）
│   │   │   ├── ui-utilities.js       # UIユーティリティ（全UI共通）
│   │   │   ├── list-manager.js       # FlexibleListシステム管理
│   │   │   └── virtual-list.js       # 仮想スクロール（大量データ対応）
│   │   │
│   │   └── tabs/                 # タブ別モジュール（TabManager継承）
│   │       ├── tab-manager.js        # タブ基底クラス（ライフサイクル管理）
│   │       ├── search-tab.js         # 検索タブ（search-handler内包）
│   │       ├── dictionary-tab.js     # 辞書タブ（dictionary-handler内包）
│   │       ├── edit-tab.js          # 編集タブ（edit-handler内包）
│   │       ├── slot-tab.js          # スロットタブ（prompt-slots密結合）
│   │       └── other-tab.js         # その他タブ（設定・インポート）
│   │
│   ├── features/             # 個別機能（ハンドラーシステム）
│   │   ├── file-handler.js       # ファイル処理（インポート・エクスポート）
│   │   ├── csv-handler.js        # CSV入出力（file-handler参照）
│   │   ├── auto-generate-handler.js # 自動生成（NovelAI連携）
│   │   ├── shortcut-manager.js   # ショートカット（main.js初期化）
│   │   ├── settings-manager.js   # 設定管理（app-state同期）
│   │   ├── search-handler.js     # 検索処理（search-tab使用）
│   │   ├── edit-handler.js       # 編集処理（edit-tab使用）
│   │   ├── dictionary-handler.js # 辞書処理（dictionary-tab使用）
│   │   └── generate-history-manager.js # 生成履歴管理
│   │
│   ├── utils/                # ユーティリティ（共通処理）
│   │   ├── element-registration.js   # 要素登録共通処理
│   │   ├── list-refresh-manager.js   # リスト更新管理システム
│   │   └── weight-converter.js       # 重み変換（SD/NAI形式）
│   │
│   └── external/             # 外部連携
│       ├── api-client.js         # API通信（翻訳・外部サービス）
│       └── global-utilities.js   # レガシー関数群（後方互換）
│
├── lib/                   # 外部ライブラリ
│   ├── jquery-3.5.1.js
│   ├── jquery-ui.js
│   └── papaparse.min.js
│
├── assets/                # 静的リソース
│   ├── icon/              # アイコンファイル
│   └── master/            # マスターデータ（デフォルト辞書）
│
├── data-management/       # データ管理ツール
│   ├── マスターデータ.tsv    # メインデータソース
│   ├── generate_master.py  # JavaScript生成スクリプト
│   ├── categories.json     # カテゴリ構造データ
│   └── categories.txt      # 人間可読カテゴリ一覧
│
└── tools/                 # 開発・運用ツール
    └── ASK_PERMISSION_AND_CONFIRM_TESTING.py  # 安全なコミットツール
```

### 🎯 アーキテクチャ特徴

- **Phase 8.5 完了**: タブモジュール化・FlexibleList システム統一
- **定数管理**: マジックナンバー・DOM 要素の完全定数化
- **CSS 分割**: テーマ対応・コンポーネント別スタイル管理
- **TabManager 基底**: 統一されたタブライフサイクル管理
- **データ保護**: Object.freeze()による偶発的変更防止
- **モジュラー設計**: 高い保守性・拡張性を実現

## 🔧 トラブルシューティング

### 拡張機能が表示されない

1. `chrome://extensions/` で有効になっているか確認
2. エラーが表示されている場合は「エラー」をクリックして詳細を確認

### データが消えた

- データは Chrome の同期ストレージに保存されています
- Chrome にログインしていることを確認
- 開発者ツール → Application → Storage → Local Storage で確認

### 翻訳が動作しない

1. インターネット接続を確認
2. DeepL API を使用する場合は、その他タブ → DeepL API キーを設定

### セレクターが機能しない

1. ページを再読み込み
2. 「その他」タブでセレクターを再設定
3. プリセットから選択、またはビジュアルセレクターで取得

## 📝 更新履歴

### v2.1.0 (2024-12-XX)

- ✨ ビジュアルセレクター機能
- ✨ マルチサービス対応
- ✨ 要素抽出モード（ランダム/連続）
- ✨ Generate 時のリアルタイム表示
- 🐛 各種バグ修正

### v2.0.0 (2024-11-XX)

- ✨ 複数プロンプトスロット管理
- ✨ CSV 入出力機能
- ✨ 自動 Generate 機能
- ✨ 設定のインポート/エクスポート
- ♻️ 大規模リファクタリング（jQuery 削除、モジュール化）

## 🎯 今後の予定

- プロンプト履歴機能
- スロットグループ機能
- テーマ切り替え（ダークモード）
- プロンプト分析機能

詳細は [Prompt Generator アップデート計画書.md](./Prompt%20Generator%20アップデート計画書.md) を参照してください。

## 📄 ライセンス

[MIT ライセンス](LICENSE)

## 🤝 貢献

バグ報告や機能提案は [Issues](https://github.com/MilkyPuree/PromptGenerator/issues) へ

## 📧 連絡先

- GitHub: [@MilkyPuree](https://github.com/MilkyPuree)
- X(Twitter): [@milky_puree](https://twitter.com/milky_puree)

---

⭐ このプロジェクトが役に立ったら、スターをお願いします！
